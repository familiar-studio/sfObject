"use strict";angular.module("sfObject").factory("ForceTk",function(a){return function(b,c,d){var e=window.forcetk;return void 0===e&&(e={}),void 0===e.Client&&(e.Client=function(a,b){this.clientId=a,this.loginUrl=b||"https://login.salesforce.com/",this.proxyUrl=this.loginUrl,this.authzHeader="Authorization",this.refreshToken=null,this.sessionId=null,this.apiVersion=null,this.instanceUrl=null,this.asyncAjax=!0,this.userAgentString=null},e.Client.prototype.setUserAgentString=function(a){this.userAgentString=a},e.Client.prototype.setRefreshToken=function(a){this.refreshToken=a},e.Client.prototype.refreshAccessToken=function(b,c){var d=this,e=this.loginUrl+"/services/oauth2/token";return a({type:"POST",url:null!==this.proxyUrl?this.proxyUrl:e,cache:!1,processData:!1,data:"grant_type=refresh_token&client_id="+this.clientId+"&refresh_token="+this.refreshToken,success:b,error:c,dataType:"json",beforeSend:function(a){null!==d.proxyUrl&&a.setRequestHeader("SalesforceProxy-Endpoint",e)}})},e.Client.prototype.setSessionToken=function(a,b,c){if(this.sessionId=a,this.apiVersion="undefined"==typeof b||null===b?"v27.0":b,"undefined"==typeof c||null==c){var d=location.hostname.split("."),e=null;e=4==d.length&&"my"===d[1]?d[0]+"."+d[1]:3==d.length?d[0]:d[1],this.instanceUrl="https://"+e+".salesforce.com"}else this.instanceUrl=c},e.Client.prototype.ajax=function(b,c,d,e,f){var g=this,h=this.instanceUrl+"/services/data"+b;return console.log(g.authzHeader),console.log(g.sessionId),a({type:e||"GET",async:this.asyncAjax,url:h,contentType:"DELETE"==e||"GET"==e?null:"application/json",cache:!1,processData:!1,data:f,headers:{Authorization:"Bearer "+g.sessionId},dataType:"json"}).success(c)},e.Client.prototype.getChatterFile=function(a,b,c,d,e){var f=this,g=this.instanceUrl+a,h=new XMLHttpRequest;h.open("GET",null!==this.proxyUrl?this.proxyUrl:g,!0),h.responseType="arraybuffer",h.setRequestHeader(f.authzHeader,"Bearer "+f.sessionId),null!==f.userAgentString&&xhr.setRequestHeader("User-Agent",f.userAgentString),null!==this.proxyUrl&&h.setRequestHeader("SalesforceProxy-Endpoint",g),h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status)try{c(h.response)}catch(g){alert("Error reading the response: "+g.toString())}else 401!=h.status||e?d(h,h.statusText,h.response):f.refreshAccessToken(function(e){f.setSessionToken(e.access_token,null,e.instance_url),f.getChatterFile(a,b,c,d,!0)},d)},h.send()},e.Client.prototype.apexrest=function(b,c,d,e,f,g,h){var i=this,j=this.instanceUrl+"/services/apexrest"+b;return a({type:e||"GET",async:this.asyncAjax,url:null!==this.proxyUrl?this.proxyUrl:j,contentType:"application/json",cache:!1,processData:!1,data:f,success:c,error:!this.refreshToken||h?d:function(a,h,j){401===a.status?i.refreshAccessToken(function(a){i.setSessionToken(a.access_token,null,a.instance_url),i.apexrest(b,c,d,e,f,g,!0)},d):d(a,h,j)},dataType:"json",beforeSend:function(a){null!==i.proxyUrl&&a.setRequestHeader("SalesforceProxy-Endpoint",j),null===g&&(g={});for(paramName in g)a.setRequestHeader(paramName,g[paramName]);a.setRequestHeader(i.authzHeader,"Bearer "+i.sessionId),null!==i.userAgentString&&a.setRequestHeader("User-Agent",i.userAgentString)}})},e.Client.prototype.versions=function(a,b){return this.ajax("/",a,b)},e.Client.prototype.resources=function(a,b){return this.ajax("/"+this.apiVersion+"/",a,b)},e.Client.prototype.describeGlobal=function(a,b){return this.ajax("/"+this.apiVersion+"/sobjects/",a,b)},e.Client.prototype.metadata=function(a,b,c){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",b,c)},e.Client.prototype.describe=function(a,b,c,d){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/describe/",c,d)},e.Client.prototype.create=function(a,b,c,d){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",c,d,"POST",JSON.stringify(b))},e.Client.prototype.retrieve=function(a,b,c,d,e){4==arguments.length&&(e=d,d=c,c=null);var f=c?"?fields="+c:"";this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+f,d,e)},e.Client.prototype.upsert=function(a,b,c,d,e,f){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+"/"+c+"?_HttpMethod=PATCH",e,f,"POST",JSON.stringify(d))},e.Client.prototype.update=function(a,b,c,d,e){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+"?_HttpMethod=PATCH",d,e,"POST",JSON.stringify(c))},e.Client.prototype.del=function(a,b,c,d){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b,c,d,"DELETE")},e.Client.prototype.query=function(a,b,c){return this.ajax("/"+this.apiVersion+"/query?q="+escape(a),b,c)},e.Client.prototype.queryMore=function(a,b,c){var d="services/data",e=a.indexOf(d);return e>-1&&(a=a.substr(e+d.length)),this.ajax(a,b,c)},e.Client.prototype.search=function(a,b,c){return this.ajax("/"+this.apiVersion+"/search?q="+escape(a),b,c)},e.Client.prototype.getFieldSet=function(a,b,c){return this.ajax("/"+this.apiVersion+"/search?q="+escape(a),b,c)}),new e.Client(b,c,d)}}),angular.module("sfObject").factory("Connect",function(a,b,c,d,e,f,g,h,i){var j,k=a.defer();return j=new jsforce.Connection({oauth2:{loginUrl:d,clientId:e,clientSecret:f,proxyUrl:g},proxyUrl:g}),j.login(h,"}"+i,function(a){if(a)throw a;var b=c(j.oauth2.clientId,j.oauth2.loginUrl,null);b.setSessionToken(j.accessToken,null,j.instanceUrl),b.jsForce=j,k.resolve(b)}),k.promise}),angular.module("sfObject").service("SFObject",function(a,b,c,d){var e=function(a,b,c){this.objectName=a,this.selectFields=b,this.calculatedFields=c};return e.prototype.retrieve=function(c){var d=a.defer(),e=this.objectName,f=this.selectFields;return b.then(function(a){f=f.replace("Id,",""),a.retrieve(e,c,f,function(a){d.resolve(a)},function(a){throw a})}),d.promise},e.prototype.query=function(c){var d=a.defer(),e=this.selectFields,f=this.objectName;return c=""!=c&&null!=c?" where "+c:"",b.then(function(a){a.query("Select "+e+" from "+f+c,function(a){d.resolve(a.records)},function(a){throw a})}),d.promise},e.prototype.getPicklists=function(){var c=a.defer(),d=this.objectName,e={};return b.then(function(a){a.describe(d,null,function(a){angular.forEach(a.fields,function(a){a.picklistValues.length>0&&(e[a.name]=a.picklistValues)}),c.resolve(e)})}),c.promise},e.prototype.getInlineHelpText=function(){var c=a.defer(),d=this.objectName,e={};return b.then(function(a){a.describe(d,null,function(a){angular.forEach(a.fields,function(a){a.inlineHelpText&&(e[a.name]=a.inlineHelpText)}),c.resolve(e)})}),c.promise},e.prototype.describe=function(){var c=a.defer(),d=this.objectName;return b.then(function(a){a.describe(d,null,function(a){c.resolve(a)})}),c.promise},e.prototype.getFieldSets=function(){{var c=a.defer();this.objectName}return b.then(function(a){a.apexrest("/fieldsets",function(a){c.resolve(a)})}),c.promise},e.prototype.sendEmail=function(c){var d=a.defer(),e=JSON.stringify(c);return b.then(function(a){a.apexrest("/sendEmail",function(){d.resolve()},function(a){d.reject(a)},"POST",e)}),d.promise},e.prototype.getRecordTypes=function(){var c=a.defer(),d=this.objectName;return b.then(function(a){a.query("SELECT Id, Name FROM RecordType WHERE SobjectType = '"+d+"'",function(a){c.resolve(a.records)},function(a){throw a})}),c.promise},e.prototype["delete"]=function(c){var d=a.defer(),e=this.objectName;return b.then(function(a){a.del(e,c,function(a){d.resolve(a)},function(a){throw a})}),d.promise},e.prototype.deleteRecord=function(c){var d=a.defer(),e=this.objectName,f=c.Id;return b.then(function(a){a.del(e,f,function(a){d.resolve(a)},function(a){throw c.err=!0,a})}),d.promise},e.prototype.save=function(f,g){var h=a.defer(),i=this.objectName,j=this.calculatedFields,k=(this.selectFields,window.location.host.indexOf("force.com")),l=f.Id,m=angular.copy(f);return delete m.Id,delete m.edit,delete m.err,delete m.attributes,delete m.CreatedDate,delete m.RecordType,delete m.LastModifiedDate,angular.forEach(m,function(a,b){b.indexOf("__r")>0&&delete m[b],k>0&&(a instanceof Date?m[b]=e.prototype.formatDateTime(a):"Date_Time__c"==b&&(m[b]=e.prototype.formatDateTime(new Date(a))))}),angular.forEach(j,function(a){delete m[a]}),angular.forEach(g,function(a){delete m[a]}),b.then(function(a){f.Id?a.update(i,l,m,function(a){f.edit=!1,f.err=!1,d.$apply(),h.resolve(a)},function(a){f.err=angular.fromJson(a.responseText),f.edit=!0,c.error("wont update",a),d.$apply(),h.reject(a)}):a.create(i,m,function(a){f.Id=a.id,f.edit=!1,f.err=!1,d.$apply(),h.resolve(a)},function(a){f.err=angular.toJson(a.responseText),f.edit=!0,c.error("wont update",a),d.$apply(),h.reject(f)})}),h.promise},e.prototype.formatDateTime=function(a){var b=a.getFullYear()+"-";return a.getMonth()+1<10&&(b+="0"),b+=a.getMonth()+1+"-",a.getDate()<10&&(b+="0"),b+=a.getDate()+" ",a.getHours()<10&&(b+="0"),b+=a.getHours()+":",a.getMinutes()<10&&(b+="0"),b+=a.getMinutes()+":",a.getSeconds()<10&&(b+="0"),b+=a.getSeconds()},e}),angular.module("sfObject").directive("sfArray",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return a?a.split(";"):void 0}function f(a){return a?a.join(";"):void 0}d.$formatters.push(e),d.$parsers.push(f)}}}),angular.module("sfObject").directive("sfDate",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return a?new Date(a):void 0}function f(a){return a?a.getTime():void 0}d.$formatters.push(e),d.$parsers.push(f)}}});